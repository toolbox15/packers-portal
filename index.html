<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bears Gameday Scratch-Off</title>
    
    <script src="https://cdn.jsdelivr.net/npm/scratchcard-js@1.5.5/dist/scratchcard.min.js"></script>
    
    <style>
        html, body { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background-color: #0B162A; 
            color: white; text-align: center; font-family: sans-serif;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            touch-action: none; 
        }
        #scratch-container { 
            position: relative; width: 300px; height: 300px; 
            margin: 10px auto; border: 6px solid #C83803; 
            background-color: #1a2a44; box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        /* This ensures the canvas takes up the whole box */
        #scratch-container canvas { position: absolute; top: 0; left: 0; touch-action: none; }
        
        .instruction { color: #C83803; font-weight: bold; text-transform: uppercase; margin-top: 10px; }
        #status-log { font-size: 0.7rem; color: #555; margin-top: 5px; }
    </style>
</head>
<body>

    <h1 style="color:#fff; text-shadow: 2px 2px #C83803; margin:0;">BEAR DOWN</h1>
    <p id="msg">Loading Game...</p>

    <div id="scratch-container"></div>

    <p class="instruction">Must reveal 60% to win</p>
    <div id="status-log">Initializing...</div>

    <script>
        // 1. Define your images
        const coverSrc = 'https://toolbox15.github.io/packers-portal/scratch/cover.png';
        const prizeSrc = 'https://toolbox15.github.io/packers-portal/scratch/prize.png';

        function log(text) { document.getElementById('status-log').innerText = text; }

        // 2. Pre-load images manually
        async function initGame() {
            log("Loading Images...");
            try {
                const loadImage = src => new Promise((res, rej) => {
                    const img = new Image();
                    img.onload = () => res(img);
                    img.onerror = rej;
                    img.src = src;
                });

                await Promise.all([loadImage(coverSrc), loadImage(prizeSrc)]);
                log("Images Loaded. Starting Engine...");
                document.getElementById('msg').innerText = "Rub the screen!";

                // 3. Initialize the ScratchCard ONLY after images are ready
                const sc = new ScratchCard('#scratch-container', {
                    scratchType: SCRATCH_TYPE.CIRCLE,
                    containerWidth: 300,
                    containerHeight: 300,
                    imageForwardSrc: coverSrc,
                    imageBackgroundSrc: prizeSrc,
                    clearZoneRadius: 40,
                    percentToFinish: 60,
                    callback: function () {
                        alert('WINNER! Show this to your bartender.');
                    }
                });

                await sc.init();
                log("Game Ready.");

            } catch (err) {
                log("Error: " + err.message);
                document.getElementById('msg').innerText = "Refresh Page & Try Again";
            }
        }

        // Run on load
        window.onload = initGame;

        // Prevent standard mobile scrolling
        document.addEventListener('touchmove', (e) => { e.preventDefault(); }, { passive: false });
    </script>
</body>
</html>
